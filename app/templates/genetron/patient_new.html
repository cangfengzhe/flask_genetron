{% extends "genetron/base.html" %}

{% block head %}
{{ super() }}
<link rel="stylesheet" type="text/css"
      href="{{ url_for('static', filename='datatable/css/jquery.dataTables.min.css') }}">
<link rel="stylesheet" type="text/css"
      href="{{ url_for('static', filename='datatable/css/dataTables.bootstrap.min.css') }}">
<link rel="stylesheet" type="text/css"
      href="{{ url_for('static', filename='datatable/css/buttons.dataTables.min.css') }}">
<link rel="stylesheet" type="text/css"
      href="{{ url_for('static', filename='datatable/css/select.dataTables.min.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='editor/css/editor.dataTables.min.css') }}">
<style>

    td.details-control {
    background: url('{{ url_for("static", filename="datatable/css/details_open.png") }}') no-repeat center center;
    cursor: pointer;
}
tr.shown td.details-control {
    background: url('{{ url_for("static", filename="datatable/css/details_close.png") }}') no-repeat center center;
}
</style>

{% endblock %}

{% block content %}

<div class="container" style="margin-top:80px">


    <!--display table table-striped table-bordered hover-->

    <table id="example" class="display table  table-bordered hover" width="100%" cellspacing="0">
        <thead>
        <!--indication=None, start_time=None, dead_line=None,process=None, note=None):-->
        <!--self.patient_id-->
        <tr style="font-size:12px">
            <th></th>
            <th>ID</th>
            <th>姓名</th>
            <!--<th>Age</th>-->
            <!--<th>Sex</th>-->
            <th>医院</th>
            <th>Panel</th>
            <th>Bioinfo</th>
            <th>Histology</th>
            <th>Tissue</th>
            <th>Indication</th>
            <th>开始日期</th>
            <th>截止日期</th>
            <th>剩余</th>
            <th>报告</th>
            <th>备注</th>
        </tr>
        </thead>

    </table>
</div>

{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{{ url_for('static', filename='datatable/js/jquery.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='datatable/js/dataTables.bootstrap.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='datatable/js/jquery.dataTables.min.js') }}"></script>

<script type="text/javascript"
        src="{{ url_for('static', filename='datatable/js/dataTables.buttons.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='datatable/js/dataTables.select.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='editor/js/dataTables.editor.min.js') }}"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
<!--<script type="text/javascript" src="{{ url_for('static', filename='datatable/js/custom.js') }}"></script>-->


<script>

function format(d) {
    // `d` is the original data object for the row
    return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'+
        '<tr>'+
            '<td>生信完成时间:</td>'+
            '<td>'+d.bioinfo_time+'</td>'+
        '</tr>'+
        '<tr>'+
            '<td>索要病理时间</td>'+
            '<td>'+d.ask_histology_time+'</td>'+
        '</tr>'+
        '<tr>'+
            '<td>病理更新时间</td>'+
            '<td>' + d.get_histology_time +'</td>'+
        '</tr>'+
           '<tr>'+
            '<td>报告完成时间</td>'+
            '<td>' + d.bioinfo_time + '</td>'+
        '</tr>'+
    '</table>';
}

$(document).ready(function() {

console.log('afd');

   var table =  $('#example').DataTable( {
        <!--dom: "Bfrtip",-->
        ajax: "{{ url_for('genetron.patient_table') }}",
        <!--"order": [[ 11, 'desc' ],[ 10, 'asc' ], [ 4, 'asc' ]],-->
        <!--"pageLength": 20,-->
        columns: [
          {
                'className': 'details-control',
                'orderable':  false,
                'data': null,
                'defaultContent': ''
            },
            { data: 'patient_id' },
            { data: "name" },
            { data: "hospital" },
            { data: "panel" },
            {
                "class": "center",
                "data": "bioinfo",
                "render": function (val, type, row) {
                    return val == true ? "完成" : "未完成";
                }
            },
            { data: "histology" },
            { data: "tissue" },
            { data: "indication" },
            { data: "start_time" },
            { data: "dead_line" },
            { data: null,
                "render":function(data,type, row){
                    today = new Date()
                    dead_line = new Date(data.dead_line)
                    return Math.round((dead_line-today)/(24*60*60*1000))
                }
            },
            {
                "class": "center",
                "data": "is_finish",
                "render": function (val, type, row) {
                    return val == true ? "完成" : "未完成";
                }
            },
            { data: "note" }

        ],
        "order": [[1, 'asc']]

    } );

       $('#example tbody').on('click', 'td.details-control', function () {
        var tr = $(this).closest('tr');
        var row = table.row( tr );

        if ( row.child.isShown() ) {
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            row.child( format(row.data()) ).show();
            tr.addClass('shown');
        }
    } );

} );



</script>
{% endblock %}
