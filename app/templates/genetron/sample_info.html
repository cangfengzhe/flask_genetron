{% extends "genetron/base.html" %}

{% block head %}
{{ super() }}

<link href="{{ url_for('static', filename='kendo_ui/styles/kendo.common.min.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='kendo_ui/styles/kendo.rtl.min.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='kendo_ui/styles/kendo.bootstrap.min.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='kendo_ui/styles/kendo.dataviz.min.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='kendo_ui/styles/kendo.dataviz.bootstrap.min.css')}}" rel="stylesheet">

<script type="text/javascript" src="{{ url_for('static', filename='kendo_ui/js/jszip.min.js')}}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='kendo_ui/js/kendo.all.min.js')}}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='kendo_ui/js/console.js')}}"></script>
{% endblock %}

{% block content %}


<div class="container-fluid">
    <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <div class="panel panel-info">
                <div class="panel-heading">
                    患者基本信息
                </div>
                {% if sample.patient != None %}
                <div class="panel-body">
                    <table class="table table-condensed">
                        <tr>
                            <td>患者信息: {{sample.patient.name}}</td>
                            <td>患者编号: {{sample.patient.patient_id}}</td>
                        </tr>
                        <tr>
                            <td>性别:{% if sample.patient.sex == 1 %}
                                男
                                {% else %}
                                女
                                {% endif %}
                            </td>
                            <td>年龄: {{sample.patient.age}}</td>
                        </tr>
                        <tr>
                            <td>既往诊断结果: {{sample.indication}}</td>
                            <td>既往治疗方案:</td>
                        </tr>
                        <tr>
                            <td>靶向药物服用史:</td>
                            <td>癌症家族史:</td>
                        </tr>

                    </table>
                </div>


            </div>
            {% endif %}
            <!-- /.panel -->
        </div>
    </div>


    <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <div class="panel panel-info">
                <div class="panel-heading">
                    样本基本信息
                </div>
                {% if sample.patient != None %}
                <div class="panel-body">
                    <table class="table table-condensed">
                         <tr>
                            <td>肿瘤样本ID: {{sample.sample_id}}</td>
                            <td>医院: {{sample.patient.hospital}}</td>
                        </tr>
                        <tr>
                            <td>肿瘤样本类型: {{sample.tumor_type}}</td>
                            <td>肿瘤样本采集部位: {{sample.tumor_pos}}</td>
                        </tr>
                        <tr>
                            <td>肿瘤采集日期: {{ sample.collect_time|datetimeformat("%Y-%m-%d %H:%M:%S") }}
                            </td>
                            <td>肿瘤样本接受日期: {{ sample.accept_time|datetimeformat("%Y-%m-%d %H:%M:%S") }}</td>
                        </tr>
                        <tr>
                            <td>组织:  {{ sample.tumor}}
                            </td>
                            <td>癌种: {{ sample.tissue}} </td>
                        </tr>

                    </table>
                </div>


            </div>
            {% endif %}
            <!-- /.panel -->
        </div>
    </div>


    <!-- time -->

    <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <div class="panel panel-info">
                <div class="panel-heading">
                    生物信息分析
                </div>
                <div class="panel-body">
                    <table class="table table-condensed">
                        <tr>
                            <th>Flowcell_ID</th>
                            <th>Panel</th>
                            <th>下机时间</th>
                            <th>拆分时间</th>
                            <th>分类时间</th>
                            <th>提交时间</th>
                            <th>生信完成时间</th>
                            <th>生信报告时间</th>

                        </tr>
                        {% set flowcell_list=[] %}
                        {% for flowcell_index in sample.sample_flowcell.all() %}

                        <tr>
                            <td>{{ flowcell_index.flowcell.flowcell_id }}</td>
                            <td>{{ flowcell_index.panel }}</td>
                            <td>{{ flowcell_index.flowcell.xj_time|datetimeformat("%Y-%m-%d %H:%M:%S") }}</td>

                            <td>{{ flowcell_index.flowcell.cf_time|datetimeformat("%Y-%m-%d %H:%M:%S") }}</td>

                            <td>{{flowcell_index|get_item_time('class')}}</td>
                            <td>{{flowcell_index|get_item_time('submit')}}</td>
                            <td>{{flowcell_index|get_item_time('bioinfo_finish')}}</td>
                            <td>
                                {{flowcell_index|get_item_time('bioinfo_report')}}
                            </td>

                        </tr>
                         {% if flowcell_list.append( (flowcell_index.flowcell.flowcell_id, flowcell_index.panel) )  %} {% endif %}
                      
                        {% endfor %}

                    </table>
                </div>


            </div>
            <!-- /.panel -->
        </div>
    </div>    
    
     <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <div class="panel panel-info">
                <div class="panel-heading">
                    验证信息
                </div>
                
                <div class="panel-body">
                    <div id='check_info'> </div>
                </div>


            </div>
            <!-- /.panel --> 
        </div>
    </div>
    
        <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <div class="panel panel-info">
                <div class="panel-heading">
                    样本备注
                </div>
                
                <div class="panel-body">
                    <div id='note_info'> </div>
                </div>


            </div>
            <!-- /.panel --> 
        </div>
    </div>
    
           <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <div class="panel panel-info">
                <div class="panel-heading">
                 
                    基因变异信息
                </div>
                
                <div class="panel-body">
                     <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#snv_tab" aria-controls="snv" role="tab" data-toggle="tab">基因点突变、缺失、插入分析结果</a></li>
                    <li role="presentation"><a href="#cnv_tab" aria-controls="cnv_tab" role="tab" data-toggle="tab">拷贝数分析结果</a></li>
                     <li role="presentation"><a href="#sv_tab" aria-controls="sv_tab" role="tab" data-toggle="tab">基因重排分析结果</a></li>
                 </ul>
                  <!-- Tab panes -->
                  <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="snv_tab">
                        <ul   class="list-group">
                             <div id='snp_indel'> </div>
                        </ul>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="cnv_tab">
                        <div id='cnv'> </div>
                    </div>
                      <div role="tabpanel" class="tab-pane" id="sv_tab">
                        <div id='sv'> </div>
                    </div>
                  </div>
                   
                </div>


            </div>
            <!-- /.panel --> 
        </div>
    </div>

    
    
  
    
    <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <div class="panel panel-info">
                <div class="panel-heading">
                    医学信息解读
                </div>
                <div class="panel-body">
                     <div id='report'> </div>
                </div>


            </div>
            <!-- /.panel -->


        </div>
    </div>

    

    <div class="row">
        <div  class="col-lg-10 col-lg-offset-1">
            <div class="panel panel-info">
                <div class="panel-heading">
                    文件上传
                </div>
                <div class="panel-body">
                  <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">File</a></li>
                    <li role="presentation"><a href="#upload" aria-controls="upload" role="tab" data-toggle="tab">Upload</a></li>
                 </ul>
                  <!-- Tab panes -->
                  <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="home">
                        <ul  id="filelist" class="list-group">

                        </ul>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="upload">
                        <input name="file" id="files" type="file" >
                    </div>
                  </div>
                </div>
                </div>

            </div>
            <!-- /.panel -->


        </div>
    </div>
    
    
  


</div>


<script>
    
    var textEditorInitialize = function(container, options) {
        $('<textarea rows="10" data-bind="value: ' + options.field + '"></textarea>').appendTo(container);
};
    
       function UserDropDownEditor(container, options) {
                    $('<input required name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            autoBind: false,
                            dataTextField: "user_name",
                            dataValueField: "user_id",
                            dataSource: {
                                type: "json",
                                transport: {
                                    read: "/api/user/Reporter"
                                },
                            },
                        });
                }
    
      function PanelDropDownEditor(container, options) {
                    $('<input required name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            autoBind: false,
                            dataSource: {
                                type: "json",
                                data: ['panel203','panel51',"panel509",'panel63', "panel88", 'WES'],
                            },
                        });
                }
    
    function ReportTypeDropDownEditor(container, options) {
                    $('<input required name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            autoBind: false,
                            dataSource: {
                                type: "json",
                                data: ["初稿", "审核", "复核"],
                            },
                        });
                }
    
    
 $("#snp_indel").kendoGrid({
                        dataSource: {
                            transport: {
                                read:  {
                                url: '/api/snpindel/{{sample.sample_id}}',
                                dataType: "json" // "jsonp" is required for cross-domain requests; use "json" for same-domain requests
                                },
                                destroy: {
                                    url: '/api/snpindel/{{sample.sample_id}}',
                                    dataType: "json",
                                    type: 'delete'
                                },
                               
                            },
                            schema: {
                                type: 'json',
                                data: "data",
                                total: function(data) {
                                    return data.data.length;
                            },
                            model: {
                                id: "id",
                                 fields: {
                                     panel: { type: "string" },
                                     gene: { type: "string" },
                                     refseq: { type: "string" },
                                     chrome: { type: "string" },
                                     start: { type: "string" },
                                     end: { type: "string" },
                                     cDNA_change: { type: "string" },
                                     aa_change: { type: "string" },
                                     mut_type: { type: "string" },
                                     t_freq: { type: "string" },
                                    }
                                }
                            },
                            sort: {
                                field: "gene",
                                dir: "desc"
                            },
                            pageSize: 5,
                        },
                        scrollable: false,
                        sortable:true,
                        pageable: true,
                        serverFiltering: false,
                        serverPaging: false,
                        serverSorting: false,
                        editable: "popup",
                        dataBound: function() {
                            console.log(this.dataSource.totalPages())
                            if (this.dataSource.totalPages() <= 1) {
                              this.pager.element.hide();
                             }
                         },
                        columns: [
                        
                            {
                                field:"panel",
                                title: "panel",
                                width: 80,

                            },
                            {
                                field:"gene_name",
                                title: "基因名称",
                                width: 100,
                            },
                            {
                                field:"refseq_id",
                                title: "转录本",
                                width: 160,

                            },
                            {
                                field:"chrome",
                                title: "染色体",
                                width: 50,

                            },
//                             {
//                                 field:"start",
//                                 title: "起始位置",
//                                 width: 100,

//                             },
//                             {
//                                 field:"end",
//                                 title: "终止位置",
//                                 width: 100,

//                             },
                            {
                                field:"cDNA_change",
                                title: "核苷酸变化",
                                width: 100,
                            },
                            {
                                field:"aa_change",
                                title: "氨基酸变化",
                                width: 120,
                            },
                             {
                                field:"mut_type",
                                title: "突变类型",
                                width: 120,

                            },
                            {
                                field:"t_freq",
                                title: "突变频率",
                                width: 100,
                                template: '#=t_freq#%'
                            },
                            
                          { command: [ "destroy"], title: "&nbsp;", width: "250px" }, 
                       ],
                    });


    /// cnv
     $("#cnv").kendoGrid({
                        dataSource: {
                            transport: {
                                read:  {
                                url: '/api/cnv/{{sample.sample_id}}',
                                dataType: "json" // "jsonp" is required for cross-domain requests; use "json" for same-domain requests
                                },
                                destroy: {
                                    url: '/api/cnv/{{sample.sample_id}}',
                                    dataType: "json",
                                    type: 'delete'
                                },
                            },
                            schema: {
                            type: 'json',
                            data: "data",
                            total: function(data) {
                                return data.data.length;
                            },
                            model: {
                                id: "id",
                                 fields: {
                                    
                                     panel: { type: "string" },
                                     gene: { type: "string" },
                                     chrome: { type: "string" },
                                     start: { type: "string" },
                                     end: { type: "string" },
                                     fold: { type: "string" },
                                     cnv_type: { type: "string" }, 
                                    }
                                }
                            },
                            sort: {
                                field: "gene",
                                dir: "desc"
                            },
                            pageSize: 5,
                        },
                        scrollable: false,
                        sortable:true,
                        pageable: true,
                        dataBound: function() {
                            console.log(this.dataSource.totalPages())
                            if (this.dataSource.totalPages() <= 1) {
                              this.pager.element.hide();
                             }
                         },
                        columns: [                    
                            {
                                field:"panel",
                                title: "panel",
                                width: 80,
                            },
                            {
                                field:"gene_name",
                                title: "基因名称",
                                width: 100,
                            },
                          
                            {
                                field:"chrome",
                                title: "染色体",
                                width: 50,
                            },
                            {
                                field:"start",
                                title: "起始位置",
                                width: 100,
                            },
                            {
                                field:"end",
                                title: "终止位置",
                                width: 100,
                            },
                            {
                                field:"fold",
                                title: "变异倍数",
                                width: 100,                        
                            },
                             {
                                field:"cnv_type",
                                title: "变异类型",
                                width: 120,

                            },
                             { command: [ "destroy"], title: "&nbsp;", width: "250px" }, 
                       ],
                    });

         $("#check_info").kendoGrid({
                        dataSource: {
                             error: function (e) {
                                alert("Status: " + e.status + "; Error message: " + e.errorThrown );
                                console.log(e)
                            },
                            autoSync: false,
                            transport: {
                                read:  {
                                    url: '/api/check/{{sample.sample_id}}',
                                    dataType: "json" // "jsonp" is required for cross-domain requests; use "json" for same-domain requests
                                },
                                update: {
                                    url: '/api/check/{{sample.sample_id}}',
                                    type: 'post',
                                    dataType: "json",
                                },
                                destroy: {
                                    url: '/api/check/{{sample.sample_id}}',
                                    dataType: "json",
                                    type: 'delete'
                                },
                                create: {
                                    type: 'post',
                                    url: '/api/check/{{sample.sample_id}}',
                                    dataType: "json"
                                },
                                 parameterMap: function(data, operation) {
                                    if (operation === "update" || operation === "create") {
                                        data.start_time = kendo.toString(kendo.parseDate(data.start_time), "s");
                                        if (data.end_time != ''){
                                            data.end_time = kendo.toString(kendo.parseDate(data.end_time), "s");
                                        }

                                    }
                                return data;
                            }
                            },
                            batch: false,
                            schema: {
                                type: 'json',
                                data: "data",
                                total: function(data) {
                                    return data.data.length;
                                },
                            
                            model: {
                                id: "id",
                                fields: {
                                     id: {type: "numeric", nullable: true},
                                     flowcell_id: { type: "string", validation: { required: true } },
                                     panel: { type: "string", validation: { required: true } },
                                     gene: { type: "string", nullable: true },
                                     check_type: { type: "string" , nullable: true},
                                     start_time: { type: "date", format: "{0: yyyy-MM-dd HH:mm:ss}", },
                                     end_time: { type: "date", format: "{0: yyyy-MM-dd HH:mm:ss}", nullable: true },
                                     result: { type: "string", nullable: true },
                                     note: { type: "string", nullable: true, },
                                    }
                                }
                            },
                            pageSize: 5,
                        },
                        toolbar: ["create"],
                        scrollable: false,
                        sortable:true,
                        pageable: true,
                        editable: "popup",
                        dataBound: function() {
                            if (this.dataSource.totalPages() <= 1) {
                              this.pager.element.hide();
                             }
                         },
                        columns: [
                            {
                                field:"flowcell_id",
                                title: "Flowcell",
                                width: 50,
                            },
                            {
                                field:"panel",
                                title: "panel",
                                width: 50,
                                editor:PanelDropDownEditor
                            },
                            {
                                field:"gene_name",
                                title: "基因名称",
                                width: 80,
                            },
                            {
                                field:"check_type",
                                title: "验证类型",
                                width: 100,
                            },
                            {
                                field:"start_time",
                                title: "开始时间",
                                width: 150,
                                format: "{0: yyyy-MM-dd HH:mm:ss}"
                            },
                            {
                                field:"end_time",
                                title: "反馈时间",
                                width: 150,
                                format: "{0: yyyy-MM-dd HH:mm:ss}"
                            },
                            {
                                field:"result",
                                title: "结果",
                                width: 100,
                            },
                            {
                                field:"note",
                                title: "备注",
                                width: 130,
                                editor: textEditorInitialize ,
                            },
                            { command: ["edit", "destroy"], title: "&nbsp;", width: "250px" },
                       ],
                    });
    
    
     $("#note_info").kendoGrid({
                        dataSource: {
                             error: function (e) {
                                alert("Status: " + e.status + "; Error message: " + e.errorThrown );
                                console.log(e)
                            },
                            autoSync: false,
                            transport: {
                                read:  {
                                    url: '/api/note/{{sample.sample_id}}',
                                    dataType: "json" // "jsonp" is required for cross-domain requests; use "json" for same-domain requests
                                },
                                update: {
                                    url: '/api/note/{{sample.sample_id}}',
                                    type: 'post',
                                    dataType: "json",
                                },
                                destroy: {
                                    url: '/api/note/{{sample.sample_id}}',
                                    dataType: "json",
                                    type: 'delete'
                                },
                                create: {
                                    type: 'post',
                                    url: '/api/note/{{sample.sample_id}}',
                                    dataType: "json"
                                },
                                 parameterMap: function(data, operation) {
                                if (operation === "update" || operation === "create") {
                                    data.start_time = kendo.toString(kendo.parseDate(data.start_time), "s");
                                    if (data.end_time != ''){
                                        data.end_time = kendo.toString(kendo.parseDate(data.end_time), "s");
                                    }
                                    
                                }
                                return data;
                            }
                            },
                            batch: false,
                            schema: {
                                type: 'json',
                                data: "data",
                                total: function(data) {
                                    return data.data.length;
                                },
                            
                            model: {
                                id: "id",
                                fields: {
                                     id: {type: "numeric", nullable: true},
                                     flowcell_id: { type: "string", validation: { required: true } },
                                     panel: { type: "string", validation: { required: true } },
                                  
                                     note: { type: "textarea", nullable: true },
                                    }
                                }
                            },
                            pageSize: 5,
                        },
                        toolbar: ["create"],
                        scrollable: false,
                        sortable:true,
                        pageable: true,
                        editable: "popup",
                        dataBound: function() {
                            if (this.dataSource.totalPages() <= 1) {
                              this.pager.element.hide();
                             }
                         },
                        columns: [
                            {
                                field:"flowcell_id",
                                title: "Flowcell",
                                width: 50,
                            },
                            {
                                field:"panel",
                                title: "panel",
                                width: 50,
                                editor:PanelDropDownEditor
                            },
                          
                            {
                                field:"note",
                                title: "备注",
                                width: 300,  
                                editor: textEditorInitialize ,
                            },
                            { command: ["edit", "destroy"], title: "&nbsp;", width: "250px" },
                       ],
                    });
    
    
    
    
    $("#sv").kendoGrid({
                        dataSource: {
                            transport: {
                                read:  {
                                url: '/api/sv/{{sample.sample_id}}',
                                dataType: "json" // "jsonp" is required for cross-domain requests; use "json" for same-domain requests
                                },
                                destroy:  {
                                url: '/api/sv/{{sample.sample_id}}',
                                dataType: "json", // "jsonp" is required for cross-domain requests; use "json" for same-domain requests
                                type: 'delete'
                                }
                                
                            },
                            schema: {

                            type: 'json',
                            data: "data",
                            total: function(data) {
                                return data.data.length;
                            },
                            model: {
                                 id:'id',
                                 fields: {
                                    
                                     panel: { type: "string" },
                                     gene: { type: "string" },
                                     break_pos: { type: "string" },
                                     extron_pos: { type: "string" },
                                     freq: { type: "numeric" },
                                     
                                    }
                                }
                            },
                            sort: {
                                field: "gene",
                                dir: "desc"
                            },
                            pageSize: 5,
                        },
                        scrollable: false,
                        sortable:true,
                        pageable: true,
                        editable: 'popup',
                        dataBound: function() {
                            console.log(this.dataSource.totalPages())
                            if (this.dataSource.totalPages() <= 1) {
                              this.pager.element.hide();
                             }
                         },
                        columns: [                    
                            {
                                field:"panel",
                                title: "panel",
                                width: 80,
                            },
                            {
                                field:"gene_name",
                                title: "基因名称",
                                width: 100,
                            },
                          
                     
                            {
                                field:"break_pos",
                                title: "融合基因转录本及断点位置",
                                width: 100,
                            },
                            {
                                field:"extron_pos",
                                title: "外显子",
                                width: 100,
                            },
                            {
                                field:"freq",
                                title: "频率",
                                width: 100,                        
                            },
                        
                           { command: [ "destroy"], title: "&nbsp;", width: "250px" }, 
                            
                           
                       ],
                    });
        
    
    
    $("#report").kendoGrid({
                        dataSource: {
                            error: function (e) {
                                alert("Status: " + e.status + "; Error message: " + e.errorThrown );
                                console.log(e)
                                },
                            autoSync: false,
                            transport: {
                                read:  {
                                    url: '/api/report/{{sample.sample_id}}',
                                    dataType: "json" // "jsonp" is required for cross-domain requests; use "json" for same-domain requests
                                },
                                update: {
                                    url: '/api/report/{{sample.sample_id}}',
                                    type: 'post',
                                    dataType: "json",
                                },
                                destroy: {
                                    url: '/api/report/{{sample.sample_id}}',
                                    dataType: "json",
                                    type: 'delete'
                                },
                                create: {
                                    type: 'post',
                                    url: '/api/report/{{sample.sample_id}}',
                                    dataType: "json"
                                },
                                parameterMap: function(data, operation) {
                                    if (operation === "update" || operation === "create") {
                                        data.start_time = kendo.toString(kendo.parseDate(data.start_time), "yyyy-MM-dd HH:mm:ss");

                                        if (data.finish_time != ''){
                                            data.finish_time = kendo.toString(kendo.parseDate(data.finish_time), "yyyy-MM-dd HH:mm:ss");
                                        }
                                    
                                    }
                                    return data;
                                }
                            },
                            batch: false,
                            schema: {
                                type: 'json',
                                data: "data",
                                total: function(data) {
                                    return data.data.length;
                                },
                            
                            model: {
                                id: "id",
                                fields: {
                                     id: {type: "numeric", nullable: true},
                                     panel: { type: "string", validation: { required: true }, defaultValue: 'panel509' },
                                     report_type: { type: "string", validation: { required: true }, defaultValue: '初稿' },
                                     start_time: { type: "date", format: "{0: yyyy-MM-dd HH:mm:ss}", },
                                     reporter: { nullable: false,},
                                     finish_time: { type: "date", format: "{0: yyyy-MM-dd HH:mm:ss}", nullable: true },
                                     note: { type: "string", nullable: true },
                                    }
                                }
                            },
                            pageSize: 5,
                        },
                        {% if current_user.is_reporter() %}
                            toolbar: ["create"],
                           editable: "popup",
                        {% endif %}
                        scrollable: false,
                        sortable: true,
                        pageable: true,
                        
                        dataBound: function() {
                            console.log(this.dataSource.totalPages())
                            if (this.dataSource.totalPages() <= 1) {
                              this.pager.element.hide();
                             }
                         },
                        columns: [
                            {
                                field:"panel",
                                title: "panel",
                                width: 50,
                                editor:PanelDropDownEditor
                            },
                            {
                                field:"report_type",
                                title: "报告类型",
                                width: 50,
                                editor:ReportTypeDropDownEditor,
                            },
                            {
                                field:"reporter",
                                title: "人员",
                                width: 80,
                                editor: UserDropDownEditor,
                                // template: "#=reporter#"
                            },
                            {
                                field:"start_time",
                                title: "开始时间",
                                width: 150,
                                format: "{0: yyyy-MM-dd HH:mm:ss}"
                            },
                            {
                                field:"finish_time",
                                title: "完成时间",
                                width: 150,
                                format: "{0: yyyy-MM-dd HH:mm:ss}"
                            },
                            {
                                field:"note",
                                title: "备注",
                                width: 130,                        
                            },
                            
                            {% if current_user.is_reporter() %}
                           { command: ["edit", "destroy"], title: "&nbsp;", width: "250px" },
                        {% endif %}
                            
                       ],
                    });
    
    
 $("#files").kendoUpload({
        async: {
            saveUrl: "/genetron/upload?sample={{sample.sample_id}}",
            removeUrl: "/genetron/rmfile?sample={{sample.sample_id}}",
            autoUpload: false
        },
        clear: onClear,
     localization: {
        dropFilesHere: "customDropFilesHere"
    },

    multiple: true,
 });
   function onClear(e) {
        // Optionally cancel the clear operation by calling preventDefault method
        e.preventDefault();
    };

</script>

<script>

    $(function(){
       $.getJSON(
         "/genetron/filelist?sample={{sample.sample_id}}",
         function(data){
             data['data'].forEach(function(item){
                 $('#filelist').append('<li class="list-group-item"><a href="{{url_for('static', filename='upload/')}}' +item + '">' + item + '</a></li>');
             })

         }
       )
    })
</script>

{% endblock %}

